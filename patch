  1 diff -uprN '--exclude=.git' linux-kernel-4.4-bak/arch/arm/Kconfig linux-kernel-4.4/arch/arm/Kconfig   2 --- linux-kernel-4.4-bak/arch/arm/Kconfig   2016-12-29 09:38:08.702047365 +0800   3 +++ linux-kernel-4.4/arch/arm/Kconfig   2017-04-01 15:44:37.931993953 +0800   4 @@ -811,6 +811,8 @@ config ARCH_VIRT   5  #   6  source "arch/arm/mach-mvebu/Kconfig"   7     8 +source "drivers/alidrivers/modules/aliarch/arm/mach-ali/Kconfig"   9 +  10  source "arch/arm/mach-alpine/Kconfig"  11    12  source "arch/arm/mach-asm9260/Kconfig"  13 diff -uprN '--exclude=.git' linux-kernel-4.4-bak/arch/arm/kernel/head.S linux-kernel-4.4/arch/arm/kernel/head.S  14 --- linux-kernel-4.4-bak/arch/arm/kernel/head.S 2016-12-29 09:38:08.702047365 +0800  15 +++ linux-kernel-4.4/arch/arm/kernel/head.S 2017-04-01 15:44:37.931993953 +0800  16 @@ -52,7 +52,8 @@  17     .equ    swapper_pg_dir, KERNEL_RAM_VADDR - PG_DIR_SIZE  18    19     .macro  pgtbl, rd, phys  20 -   add \rd, \phys, #TEXT_OFFSET  21 +   ldr r0, =TEXT_OFFSET  22 +   add \rd, \phys, r0  23     sub \rd, \rd, #PG_DIR_SIZE  24     .endm  25    26 diff -uprN '--exclude=.git' linux-kernel-4.4-bak/arch/arm/Makefile linux-kernel-4.4/arch/arm/Makefile  27 --- linux-kernel-4.4-bak/arch/arm/Makefile  2016-12-29 09:38:08.702047365 +0800  28 +++ linux-kernel-4.4/arch/arm/Makefile  2017-04-01 15:44:37.931993953 +0800  29 @@ -141,6 +141,7 @@ head-y      := arch/arm/kernel/head$(MMUEXT)  30  # Text offset. This list is sorted numerically by address in order to  31  # provide a means to avoid/resolve conflicts in multi-arch kernels.  32  textofs-y  := 0x00008000  33 +textofs-$(CONFIG_ARCH_ALI) := 0x03008000  34  textofs-$(CONFIG_ARCH_CLPS711X) := 0x00028000  35  # We don't want the htc bootloader to corrupt kernel during resume  36  textofs-$(CONFIG_PM_H1940)      := 0x00108000  37 @@ -249,13 +250,13 @@ TEXT_OFFSET := $(textofs-y)  38  ifneq ($(machine-y),)  39  MACHINE  := arch/arm/mach-$(word 1,$(machine-y))/  40  else  41 -MACHINE  :=  42 +MACHINE  := drivers/alidrivers/modules/aliarch/arm/mach-ali/  43  endif  44  ifeq ($(CONFIG_ARCH_MULTIPLATFORM),y)  45  MACHINE  :=  46  endif  47    48 -machdirs := $(patsubst %,arch/arm/mach-%/,$(machine-y))  49 +machdirs := $(patsubst %,drivers/alidrivers/modules/aliarch/arm/mach-%/,ali)  50  platdirs := $(patsubst %,arch/arm/plat-%/,$(sort $(plat-y)))  51    52  ifneq ($(CONFIG_ARCH_MULTIPLATFORM),y)  53 diff -uprN '--exclude=.git' linux-kernel-4.4-bak/arch/mips/Kbuild linux-kernel-4.4/arch/mips/Kbuild  54 --- linux-kernel-4.4-bak/arch/mips/Kbuild   2016-12-29 09:38:08.702047365 +0800  55 +++ linux-kernel-4.4/arch/mips/Kbuild   2017-04-01 15:44:44.491993948 +0800  56 @@ -4,7 +4,7 @@  57  subdir-ccflags-y := -Werror  58    59  # platform specific definitions  60 -include arch/mips/Kbuild.platforms  61 +include drivers/alidrivers/modules/aliarch/mips/ali/Kbuild.platforms  62  obj-y := $(platform-y)  63    64  # make clean traverses $(obj-) without having included .config, so  65 diff -uprN '--exclude=.git' linux-kernel-4.4-bak/arch/mips/Kconfig linux-kernel-4.4/arch/mips/Kconfig  66 --- linux-kernel-4.4-bak/arch/mips/Kconfig  2016-12-29 09:38:08.702047365 +0800  67 +++ linux-kernel-4.4/arch/mips/Kconfig  2017-04-01 15:44:44.491993948 +0800  68 @@ -968,8 +968,33 @@ config MIPS_PARAVIRT  69     help  70       This option supports guest running under ????  71    72 +config ARCH_ALI  73 +   bool "ALi SoCs family of machines"  74 +   select BOOT_ELF32  75 +   select CEVT_R4K  76 +   select CSRC_R4K  77 +   select DMA_NONCOHERENT  78 +   select IRQ_CPU  79 +   select COMMON_CLK  80 +   select USE_OF  81 +   select LIBFDT  82 +   select SYS_HAS_CPU_MIPS32_R1  83 +   select SYS_HAS_CPU_MIPS32_R2  84 +   select SYS_SUPPORTS_32BIT_KERNEL  85 +   select SYS_SUPPORTS_LITTLE_ENDIAN  86 +   select SYS_SUPPORTS_MULTITHREADING  87 +   select MIPS_GIC  88 +   select SERIAL_8250  89 +   select SERIAL_8250_CONSOLE  90 +   select IRQ_MIPS_CPU  91 +   select ARCH_REQUIRE_GPIOLIB  92 +   select SYS_SUPPORTS_HIGHMEM  93 +  94 +   help  95 +     This enables support for the ALi Corp.  96  endchoice  97    98 +source "drivers/alidrivers/modules/aliarch/mips/ali/Kconfig"  99  source "arch/mips/alchemy/Kconfig" 100  source "arch/mips/ath25/Kconfig" 101  source "arch/mips/ath79/Kconfig" 102 diff -uprN '--exclude=.git' linux-kernel-4.4-bak/arch/mips/Makefile linux-kernel-4.4/arch/mips/Makefile 103 --- linux-kernel-4.4-bak/arch/mips/Makefile 2017-04-01 15:36:08.567994372 +0800 104 +++ linux-kernel-4.4/arch/mips/Makefile 2017-04-01 15:44:44.491993948 +0800 105 @@ -224,7 +224,7 @@ endif 106  # 107  # Board-dependent options and extra files 108  # 109 -include arch/mips/Kbuild.platforms 110 +include drivers/alidrivers/modules/aliarch/mips/ali/Kbuild.platforms 111   112  ifdef CONFIG_PHYSICAL_START 113  load-y                 = $(CONFIG_PHYSICAL_START) 114 diff -uprN '--exclude=.git' linux-kernel-4.4-bak/drivers/Kconfig linux-kernel-4.4/drivers/Kconfig 115 --- linux-kernel-4.4-bak/drivers/Kconfig    2016-12-29 09:38:08.702047365 +0800 116 +++ linux-kernel-4.4/drivers/Kconfig    2017-04-01 15:44:37.931993953 +0800 117 @@ -1,5 +1,7 @@ 118  menu "Device Drivers" 119   120 +source "drivers/alidrivers/modules/Kconfig" 121 + 122  source "drivers/amba/Kconfig" 123   124  source "drivers/base/Kconfig" 125 diff -uprN '--exclude=.git' linux-kernel-4.4-bak/drivers/Makefile linux-kernel-4.4/drivers/Makefile 126 --- linux-kernel-4.4-bak/drivers/Makefile   2016-12-29 09:38:08.702047365 +0800 127 +++ linux-kernel-4.4/drivers/Makefile   2017-04-01 15:44:37.931993953 +0800 128 @@ -172,3 +172,4 @@ obj-$(CONFIG_STM)       += hwtracing/stm/ 129  obj-$(CONFIG_ANDROID)      += android/ 130  obj-$(CONFIG_NVMEM)        += nvmem/ 131  obj-$(CONFIG_FPGA)     += fpga/ 132 +obj-$(CONFIG_ARCH_ALI)     += alidrivers/modules/drivers/alidrivers/patches/0001-adding-ali-kernel-config.patch                                                                                                                     132,48-51      Bot-- VISUAL --  1 diff -uprN '--exclude=.git' linux-kernel-4.4-bak/arch/arm/Kconfig linux-kernel-4.4/arch/arm/Kconfig                                                                                                2 --- linux-kernel-4.4-bak/arch/arm/Kconfig   2016-12-29 09:38:08.702047365 +0800  3 +++ linux-kernel-4.4/arch/arm/Kconfig   2017-04-01 15:44:37.931993953 +0800  4 @@ -811,6 +811,8 @@ config ARCH_VIRT  5  #  6  source "arch/arm/mach-mvebu/Kconfig"  7   8 +source "drivers/alidrivers/modules/aliarch/arm/mach-ali/Kconfig"  9 + 10  source "arch/arm/mach-alpine/Kconfig" 11  12  source "arch/arm/mach-asm9260/Kconfig" 13 diff -uprN '--exclude=.git' linux-kernel-4.4-bak/arch/arm/kernel/head.S linux-kernel-4.4/arch/arm/kernel/head.S 14 --- linux-kernel-4.4-bak/arch/arm/kernel/head.S 2016-12-29 09:38:08.702047365 +0800 15 +++ linux-kernel-4.4/arch/arm/kernel/head.S 2017-04-01 15:44:37.931993953 +0800 16 @@ -52,7 +52,8 @@ 17     .equ    swapper_pg_dir, KERNEL_RAM_VADDR - PG_DIR_SIZE 18  19     .macro  pgtbl, rd, phys 20 -   add \rd, \phys, #TEXT_OFFSET 21 +   ldr r0, =TEXT_OFFSET 22 +   add \rd, \phys, r0 23     sub \rd, \rd, #PG_DIR_SIZE 24     .endm 25  26 diff -uprN '--exclude=.git' linux-kernel-4.4-bak/arch/arm/Makefile linux-kernel-4.4/arch/arm/Makefile 27 --- linux-kernel-4.4-bak/arch/arm/Makefile  2016-12-29 09:38:08.702047365 +0800 28 +++ linux-kernel-4.4/arch/arm/Makefile  2017-04-01 15:44:37.931993953 +0800 29 @@ -141,6 +141,7 @@ head-y      := arch/arm/kernel/head$(MMUEXT) 30  # Text offset. This list is sorted numerically by address in order to 31  # provide a means to avoid/resolve conflicts in multi-arch kernels. 32  textofs-y  := 0x00008000 33 +textofs-$(CONFIG_ARCH_ALI) := 0x03008000 34  textofs-$(CONFIG_ARCH_CLPS711X) := 0x00028000 35  # We don't want the htc bootloader to corrupt kernel during resume 36  textofs-$(CONFIG_PM_H1940)      := 0x00108000 37 @@ -249,13 +250,13 @@ TEXT_OFFSET := $(textofs-y) 38  ifneq ($(machine-y),) 39  MACHINE  := arch/arm/mach-$(word 1,$(machine-y))/ 40  else 41 -MACHINE  := 42 +MACHINE  := drivers/alidrivers/modules/aliarch/arm/mach-ali/ 43  endif 44  ifeq ($(CONFIG_ARCH_MULTIPLATFORM),y) 45  MACHINE  := 46  endif
